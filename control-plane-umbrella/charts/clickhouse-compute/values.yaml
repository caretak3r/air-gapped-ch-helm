# -- Global configuration shared across charts
global:
  # -- Image registry to use for all images
  imageRegistry: ""
  # -- List of image pull secrets to use for pulling images from private registries
  imagePullSecrets: []
  # -- Storage class name for PVCs
  storageClassName: "local-path"
  # -- Keep PVCs when uninstalling helm release to preserve data
  keepPVC: false

# -- Number of replicas for the deployment
replicaCount: 1

image:
  # -- Docker image repository
  repository: "clickhouse/clickhouse-server"
  # -- Docker image tag
  tag: "25.7-alpine"
  # -- Docker image pull policy
  pullPolicy: "Always"

# -- Service Account configuration
serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# -- RBAC configuration
rbac:
  # -- Specifies whether RBAC resources should be created
  create: true
  # -- Custom rules to add to the Role
  # rules: []

# -- Deployment level annotations
deployment:
  annotations: {}

# -- Pod level annotations
podAnnotations: {}

# -- Container level security context
securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000

# -- Service configuration
service:
  # -- Service type
  type: ClusterIP
  # -- HTTP port
  httpPort: 8123
  # -- TCP native port
  tcpPort: 9000
  # -- Service annotations
  annotations: {}

# -- Prometheus Exporter configuration
prometheus:
  # -- Enable Prometheus exporter
  enabled: true
  # -- Prometheus exporter port
  port: 9363
  # -- Prometheus metrics endpoint path
  endpoint: "/metrics"

# -- Compute resources used by the container
resources:
  # limits:
  #   cpu: 2000m
  #   memory: 4Gi
  # requests:
  #   cpu: 1000m
  #   memory: 2Gi

# -- Node selection constraints
nodeSelector: {}

# -- Tolerations for pod assignment
tolerations: []

# -- Affinity settings for pod assignment
affinity: {}

# -- Persistence configuration for data and logs
persistence:
  # -- Enable persistence
  enabled: true
  # -- Size of data volume
  dataSize: 10Gi
  # -- Size of log volume
  logSize: 5Gi
  # -- Annotations for PVCs
  annotations: {}

# -- S3 Storage configuration (tiering)
storage:
  s3:
    # -- Enable S3 storage for ClickHouse data
    enabled: true
    endpoint: "https://s3.us-east-1.amazonaws.com"
    bucket: "my-data-bucket"
    region: "us-east-1"

# -- Termination grace period in seconds
terminationGracePeriodSeconds: 90

# -- Probes configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 1
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

startupProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# -- ClickHouse Configuration
config:
  # -- Annotations for ConfigMaps
  annotations: {}
  users:
    # -- Password for the 'app' user
    appUserPassword: "password"
  # -- Network CIDRs for Kubernetes cluster access control
  clusterCidrs:
    - "10.0.0.0/8" # Most Kubernetes clusters
    - "172.16.0.0/12" # Docker Desktop etc.
    - "192.168.0.0/16" # Minikube etc.

# -- Secrets configuration
secrets:
  # -- Annotations for Secrets
  annotations: {}

# -- Scheduled Tasks (CronJobs)
tasks:
  enabled: true
  parquetConverter:
    enabled: true
    schedule: "*/10 * * * *"
    image:
      repository: my-registry/parquet-converter
      tag: latest
      pullPolicy: IfNotPresent
    # -- Pod level annotations for the cronjob
    podAnnotations: {}
    # -- Container level security context for the cronjob
    securityContext: {}
    # -- Annotations for the CronJob object
    annotations: {}
    env:
      SOURCE_BUCKET: "raw-metrics"
      DEST_BUCKET: "processed-metrics"
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 100m
        memory: 128Mi
