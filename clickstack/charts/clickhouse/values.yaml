# -- Override name of the chart
nameOverride: ""
# -- Override the full name of the chart
fullnameOverride: ""

# -- Global configuration shared across charts
global:
  # -- Image registry to use for all images
  imageRegistry: ""
  # -- List of image pull secrets to use for pulling images from private registries
  imagePullSecrets: []
  # -- Storage class name for PVCs
  storageClassName: ""
  # -- Keep PVCs when uninstalling helm release to preserve data
  keepPVC: false

image:
  # -- The registry to pull the image from
  registry: docker.io
  # -- Docker image repository
  repository: "clickhouse/clickhouse-server"
  # -- Docker image tag
  tag: "25.7-alpine"
  # -- Docker image pull policy
  pullPolicy: "Always"

# -- Controller configuration
controller:
  # -- Enable the controller (Deployment or StatefulSet)
  enabled: true
  # -- Type of controller to use: Deployment or StatefulSet
  kind: Deployment
  # -- Number of replicas for the controller
  replicas: 1
  # -- The controller update strategy. Currently only applies to controllers of kind Deployment
  updateStrategy: {}
  # -- Additional annotations for the controller object
  annotations: {}
  # -- Additional labels for the controller object
  labels: {}

# -- RBAC configuration
rbac:
  # -- Specifies whether RBAC resources should be created
  create: true
  # -- Custom rules to add to the Role
  # rules: []

# -- Deprecated: Use controller configuration instead
deployment:
  # -- Number of replicas for the deployment (deprecated, use controller.replicas instead)
  replicaCount: 1
  # -- Deployment level annotations (deprecated, use controller.annotations instead)
  annotations: {}
  # -- Restart policy
  restartPolicy: "Always"

# -- Service Account configuration
serviceAccount:
  # -- Specifies whether a service account should be created
  create: true
  # -- Annotations to add to the service account
  annotations: {}
  # -- Labels for service account
  labels: {}
  # -- The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

# -- Service configuration
service:
  # -- Create a service for exposing this chart
  enabled: true
  # -- Service type
  type: ClusterIP
  # -- ClusterIP used if service type is ClusterIP
  clusterIP: ""
  # -- LoadBalancerIP if service type is LoadBalancer
  loadBalancerIP: ""
  # -- Allowed addresses when service type is LoadBalancer
  loadBalancerSourceRanges: []
  # -- HTTP port
  httpPort: 8123
  # -- TCP native port
  tcpPort: 9000
  # -- Service annotations
  annotations: {}
  # -- Service labels
  labels: {}

# -- Environment variables for the container
env:
  # -- Timezone for the container
  TZ: UTC
  CLICKHOUSE_DB: "metrics_ingested"

  # Custom ClickHouse settings
  # CLICKHOUSE_LOG_LEVEL: information
  # CLICKHOUSE_MAX_MEMORY_USAGE: "8000000000"
  # CLICKHOUSE_MAX_THREADS: 8
  
  # Database settings
  # CLICKHOUSE_DATABASE: my_database
  
  # Performance tuning
  # CLICKHOUSE_UNCOMPRESSED_CACHE_SIZE: "8589934592"
  # CLICKHOUSE_MARK_CACHE_SIZE: "5368709120"

# -- List of extra arguments for the container
extraArgs: []
# - --loglevel warning

# -- Port configuration
ports:
  rest:
    # -- Enable the port inside the Controller and Service objects
    enabled: true
    # -- The port used as internal port and cluster-wide port if .service.type == ClusterIP
    port: 8123
    # -- The external port used if .service.type == NodePort
    nodePort: null
    # -- The protocol used for the service
    protocol: TCP
  rpc:
    # -- Enable the port inside the Controller and Service objects
    enabled: true
    # -- The port used as internal port and cluster-wide port if .service.type == ClusterIP
    port: 9000
    # -- The external port used if .service.type == NodePort
    nodePort: null
    # -- The protocol used for the service
    protocol: TCP

# -- ConfigMap configuration
configMap:
  # -- Create a new config map object
  create: true
  # -- Mount path of the config map object
  mountPath: /etc/config
  # -- Use an existing config map object
  existingConfigMap: ""
  # -- Map of configuration files as strings
  files: {}
  # file1.yml: |
  #   # contents
  # file2.yml: |
  #   # contents
  # -- Additional annotations for the config map object
  annotations: {}
  # -- Additional labels for the config map object
  labels: {}

# -- Persistent Volume Claim configuration
persistentVolumeClaim:
  # -- Create a new persistent volume claim object
  create: true
  # -- Mount path of the persistent volume claim object
  mountPath: /var/lib/clickhouse
  # -- Access mode of the persistent volume claim object
  accessMode: ReadWriteOnce
  # -- Volume mode of the persistent volume claim object
  volumeMode: Filesystem
  # -- Storage request size for the persistent volume claim object
  size: 1Gi
  # -- Storage class name for the persistent volume claim object
  storageClassName: ""
  # -- Use an existing persistent volume claim object
  existingPersistentVolumeClaim: ""
  # -- Additional annotations for the persistent volume claim object
  annotations: {}
  # -- Additional labels for the persistent volume claim object
  labels: {}

# -- Ingress Configurations
ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts: []
    # - host: "clickhouse.local"
    #   paths:
    #     - path: "/"
    #       pathType: "Prefix"
  tls: []
    # - secretName: "clickhouse-tls"
    #   hosts:
    #     - "clickhouse.local"

# -- Pod level annotations
podAnnotations: {}

# -- Pod-level security attributes. More info [here](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#security-context).
securityContext:
  fsGroup: 101
  runAsNonRoot: true
  runAsGroup: 101
  runAsUser: 101

# -- Prometheus Exporter configuration
prometheus:
  # -- Enable Prometheus exporter
  enabled: false
  # -- Prometheus exporter port
  port: 9363
  # -- Prometheus metrics endpoint path
  endpoint: "/metrics"

# -- Compute resources used by the container
resources:
  # limits:
  #   cpu: 2000m
  #   memory: 4Gi
  # requests:
  #   cpu: 1000m
  #   memory: 2Gi

# -- Node selection constraints
nodeSelector: {}

# -- Pod-level affinity. More info [here](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling).
affinity: {}
# nodeAffinity:
#   requiredDuringSchedulingIgnoredDuringExecution:
#     nodeSelectorTerms:
#       - matchExpressions:
#         - key: kubernetes.io/hostname
#           operator: In
#           values:
#             - my-node-xyz

# -- Pod-level tolerations. More info [here](https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#scheduling).
tolerations: []
# - key: node-role.kubernetes.io/control-plane
#   operator: Exists
#   effect: NoSchedule

# -- Persistence configuration for data and logs (legacy, use persistentVolumeClaim instead)
persistence:
  # -- Enable persistence
  enabled: false
  # -- Size of data volume
  dataSize: 10Gi
  # -- Size of log volume
  logSize: 5Gi
  # -- Annotations for PVCs
  annotations: {}

# -- S3 Storage configuration (tiering)
storage:
  s3:
    # -- Enable S3 storage for ClickHouse data
    enabled: false
    endpoint: "https://s3.us-east-1.amazonaws.com"
    bucket: "my-data-bucket"
    region: "us-east-1"
    annotations: {}
      # storageclass.kubernetes.io/is-default-class: false

# -- Termination grace period in seconds
terminationGracePeriodSeconds: 90

# -- Probes configuration
livenessProbe:
  enabled: true
  initialDelaySeconds: 10
  periodSeconds: 30
  timeoutSeconds: 5
  failureThreshold: 3

readinessProbe:
  enabled: true
  initialDelaySeconds: 1
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 3

startupProbe:
  enabled: true
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# -- ClickHouse Configuration
config:
  # -- Annotations for ConfigMaps
  annotations: {}
  users:
    # -- Username for the app user (used when creating default credentials)
    username: "default"
    # -- Password for the app user (used when creating default credentials)
    password: "password"
  # -- Network CIDRs for Kubernetes cluster access control
  clusterCidrs:
    - "10.0.0.0/8" # Most Kubernetes clusters
    - "172.16.0.0/12" # Docker Desktop etc.
    - "192.168.0.0/16" # Minikube etc.

# -- SQL Scripts Configuration
scripts:
  # -- Enable SQL script execution during pod termination
  enabled: false
  # -- Scripts to execute (order matters)
  files: []
  # -- Delay between script executions (in seconds)
  delayBetween: 2

# -- Secrets configuration
secrets:
  # -- Annotations for Secrets
  annotations: {}
  # -- Name of existing Kubernetes secret containing ClickHouse credentials (keys: user, password)
  # If empty, the chart will create a secret with default credentials (default/password)
  # Can also be set via global.secrets.clickhouse-credentials
  clickhouse-credentials: ""

# -- Scheduled Tasks (CronJobs)
tasks:
  enabled: true
  parquetConverter:
    enabled: true
    schedule: "*/10 * * * *"
    image:
      repository: parquet-converter
      tag: latest
      pullPolicy: Always
    # -- Pod level annotations for the cronjob
    podAnnotations: {}
    # -- Container level security context for the cronjob
    securityContext: {}
    # -- Annotations for the CronJob object
    annotations: {}
    env:
      S3_BUCKET: ""
      RAW_PREFIX: "raw"
      PROCESSED_PREFIX: "processed"
      ARCHIVE_PREFIX: "archive"
      LOOKBACK_HOURS: 0.2
    resources:
      limits:
        cpu: "500m"
        memory: "1Gi"
      requests:
        cpu: "200m"
        memory: "512Mi"
