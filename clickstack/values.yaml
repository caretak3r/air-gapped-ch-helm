global:
  region: us-east-1
  environment: production
  # -- Image registry to use for all images
  imageRegistry: ""
  # -- List of image pull secrets to use for pulling images from private registries
  imagePullSecrets: []
  # -- Secret references for external secrets
  secrets:
    # -- External secret name containing ClickHouse credentials
    clickhouseCredentials: ""

pmqs:
  enabled: true
  replicaCount: 1
  image:
    repository: my-registry/product-metrics-query-service
    tag: latest
    pullPolicy: Always
  service:
    enabled: true
    type: ClusterIP
    port: 3000

clickhouse-operator:
  enabled: true
  
  # Global settings
  global:
    imageRegistry: ""
    imagePullSecrets: []
    storageClassName: ""
  
  # Operator configuration
  operator:
    enabled: true
  
  # ClickHouse configuration
  clickhouse:
    replicasCount: 1
    
    # Image Configuration
    image:
      repository: clickhouse/clickhouse-server
      tag: "25.7-alpine"
      pullPolicy: Always
    
    # Service Configuration
    service:
      type: ClusterIP
      serviceAnnotations: {}
      serviceLabels: {}
    
    # Load balancer service (disabled by default)
    lbService:
      enabled: false
    
    # Persistence Configuration
    persistence:
      enabled: true
      size: 10Gi
      accessMode: ReadWriteOnce
      storageClass: ""
      logs:
        enabled: false
        size: 5Gi
        accessMode: ReadWriteOnce
    
    # Default user configuration
    defaultUser:
      password: "password"
      allowExternalAccess: false
      hostIP: "127.0.0.1/32"
    
    # Additional users configuration
    users:
      - name: "app_user"
        hostIP: 
          - "10.0.0.0/8"
          - "172.16.0.0/12" 
          - "192.168.0.0/16"
        accessManagement: 1
        password: "password"
        grants:
          - "GRANT SHOW ON *.*"
          - "GRANT SELECT ON system.*"
          - "GRANT SELECT ON default.*"
          - "GRANT SELECT,INSERT,CREATE,SHOW ON default.*"
    
    # Init scripts configuration
    initScripts:
      enabled: false
      configMapName: ""
      alwaysRun: true
    
    # S3 Storage Configuration
    extraConfig: |
      <clickhouse>
        <!-- S3 Storage Configuration -->
        <storage_configuration>
          <disks>
            <s3_disk>
              <type>s3</type>
              <endpoint>https://s3.amazonaws.com/my-metrics-bucket/</endpoint>
              <access_key_id></access_key_id>
              <secret_access_key></secret_access_key>
              <region>us-east-1</region>
            </s3_disk>
          </disks>
          <policies>
            <s3_policy>
              <volumes>
                <default_volume>
                  <disk>s3_disk</disk>
                </default_volume>
              </volumes>
            </s3_policy>
          </policies>
        </storage_configuration>
        
        <!-- Default Database -->
        <default_database>metrics_ingested</default_database>
        
        <!-- Timezone -->
        <timezone>UTC</timezone>
        
        <!-- Performance Settings -->
        <max_memory_usage>8000000000</max_memory_usage>
        <max_threads>8</max_threads>
      </clickhouse>
    
    # Service account configuration (important for IRSA)
    serviceAccount:
      create: true
      annotations: {}
      name: ""
    
    # Resources configuration
    resources:
      limits:
        cpu: 2000m
        memory: 4Gi
      requests:
        cpu: 1000m
        memory: 2Gi
    
    # Security context
    securityContext:
      fsGroup: 101
      runAsNonRoot: true
      runAsGroup: 101
      runAsUser: 101
  
  # CronJob Configuration for Parquet Converter
  cronjobs:
    parquetConverter:
      enabled: true
      schedule: "*/10 * * * *"
      image:
        repository: my-registry/parquet-converter
        tag: latest
        pullPolicy: Always
      env:
        SOURCE_BUCKET: "raw-metrics"
        DEST_BUCKET: "processed-metrics"
        RAW_PREFIX: "raw"
        PROCESSED_PREFIX: "processed"
        ARCHIVE_PREFIX: "archive"
        LOOKBACK_HOURS: 0.2
      resources:
        limits:
          cpu: "500m"
          memory: "1Gi"
        requests:
          cpu: "200m"
          memory: "512Mi"
      annotations: {}
      podAnnotations: {}
      securityContext: {}
