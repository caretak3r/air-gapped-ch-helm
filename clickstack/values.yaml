global:
  region: us-east-1
  environment: production
  # -- Image registry to use for all images
  imageRegistry: ""
  # -- List of image pull secrets to use for pulling images from private registries
  imagePullSecrets: []
  # -- Secret references for external secrets
  secrets:
    # -- External secret name containing ClickHouse credentials (keys: user, password)
    # If empty, clickhouse chart creates a secret with default credentials (default/password)
    clickhouse-credentials: ""

pmqs:
  enabled: true
  replicaCount: 1
  image:
    repository: my-registry/product-metrics-query-service
    tag: latest
    pullPolicy: Always
  service:
    enabled: true
    type: ClusterIP
    port: 3000

clickhouse:
  enabled: true
  
  # Controller Configuration - NEW
  controller:
    enabled: true
    kind: Deployment  # Can be Deployment or StatefulSet
    replicas: 1
    updateStrategy: {}
    annotations: {}
    labels: {}
  
  # Image Configuration - UPDATED
  image:
    registry: docker.io  # NEW
    repository: clickhouse/clickhouse-server
    tag: "25.7-alpine"  # UPDATED to latest stable
    pullPolicy: Always
  
  # Service Configuration - UPDATED
  service:
    enabled: true
    type: ClusterIP
    clusterIP: ""  # NEW
    loadBalancerIP: ""  # NEW
    loadBalancerSourceRanges: []  # NEW
    # Legacy fields kept for backward compatibility
    httpPort: 8123
    tcpPort: 9000
    annotations: {}
    labels: {}  # NEW
  
  # Environment Variables - NEW SIMPLE KEY-VALUE FORMAT
  env:
    TZ: UTC
    CLICKHOUSE_DB: "metrics_ingested"  # Example additional env var
  
  # Port Configuration - NEW
  ports:
    rest:
      enabled: true
      port: 8123
      nodePort: null
      protocol: TCP
    rpc:
      enabled: true
      port: 9000
      nodePort: null
      protocol: TCP
  
  # Service Account Configuration - NEW
  serviceAccount:
    create: true
    annotations: {}
    labels: {}
    name: ""
  
  # RBAC Configuration - NEW
  rbac:
    create: true
    # rules: []
  
  # Ingress Configuration - NEW
  ingress:
    enabled: false
    className: ""
    annotations: {}
    hosts: []
    tls: []
  
  # Persistence Configuration - NEW
  persistence:
    enabled: false
    dataSize: 10Gi
    logSize: 5Gi
    annotations: {}
  
  # Persistent Volume Claim Configuration - NEW
  persistentVolumeClaim:
    create: true
    mountPath: /var/lib/clickhouse
    accessMode: ReadWriteOnce
    volumeMode: Filesystem
    size: 10Gi  # UPDATED for production
    storageClassName: ""
    existingPersistentVolumeClaim: ""
    annotations: {}
    labels: {}
  
  # Prometheus Configuration - NEW
  prometheus:
    enabled: false
    port: 9363
    endpoint: "/metrics"
  
  # Resources Configuration - NEW
  resources:
    limits:
      cpu: 2000m
      memory: 4Gi
    requests:
      cpu: 1000m
      memory: 2Gi
  
  # Node Selection and Scheduling - NEW
  nodeSelector: {}
  tolerations: []
  affinity: {}
  
  # Security Context - NEW
  securityContext:
    fsGroup: 101
    runAsNonRoot: true
    runAsGroup: 101
    runAsUser: 101
  
  # Storage Configuration (S3) - UPDATED
  storage:
    s3:
      enabled: true  # UPDATED to true for production
      endpoint: https://s3.amazonaws.com
      bucket: my-metrics-bucket
      region: us-east-1
      annotations: {}
  
  # Tasks Configuration - KEPT WITH ENV KEY-VALUE FORMAT
  tasks:
    enabled: true
    parquetConverter:
      enabled: true
      schedule: "*/10 * * * *"
      image:
        repository: my-registry/parquet-converter
        tag: latest
        pullPolicy: Always
      podAnnotations: {}  # NEW
      securityContext: {}  # NEW
      annotations: {}  # NEW
      env:
        SOURCE_BUCKET: "raw-metrics"  # UPDATED to simple key-value
        DEST_BUCKET: "processed-metrics"
        # UPDATED with additional env vars
        RAW_PREFIX: "raw"
        PROCESSED_PREFIX: "processed" 
        ARCHIVE_PREFIX: "archive"
        LOOKBACK_HOURS: 0.2
      resources:  # NEW
        limits:
          cpu: "500m"
          memory: "1Gi"
        requests:
          cpu: "200m"
          memory: "512Mi"
  
  # Configuration and Secrets - NEW
  config:
    annotations: {}
    users:
      username: "default"
      password: "password"
    clusterCidrs:
      - "10.0.0.0/8"
      - "172.16.0.0/12"
      - "192.168.0.0/16"
  
  secrets:
    annotations: {}
    # Override global.secrets.clickhouse-credentials at chart level if needed
    clickhouse-credentials: ""
  
  # Probe Configurations - NEW
  livenessProbe:
    enabled: true
    initialDelaySeconds: 10
    periodSeconds: 30
    timeoutSeconds: 5
    failureThreshold: 3
  
  readinessProbe:
    enabled: true
    initialDelaySeconds: 1
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3
  
  startupProbe:
    enabled: true
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30
  
  # Extras - NEW
  extraArgs: []
  terminationGracePeriodSeconds: 90
  podAnnotations: {}
